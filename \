define(['jquery', 'underscore', 'backbone',
  'modules/gameController'
], function($, _, Backbone,
  GameController
) {
  var Router = Backbone.Router.extend({
    routes: {
      '': 'index',
      '#!/:mode/player-vs-cpu': 'playerVsCpu',
      '#!/:mode/cpu-vcs-cpu': 'cpuVsCpu'
    },

    index: function() {
      this.playerVsCpu();
    },

    playerVsCpu: function() {
      this.activeGameView = new GameController();
    },

    cpuVsCpu: function() {
      this.activeGameView = new GameControler({ mode: ' })
    },

    activeView: null,

    changeActiveView: function(newActiveView) {
      this.closePreviousView();
      this.activeView = newActiveView;
    },

    closePreviousView: function() {
      if (this.activeView) this.activeView.close();
      this.activeView = null;
    },

    /**
     * Forces a "reload" of the current router.
     * First it closes the current view, freeing the resources,
     * and then re-triggers the navigate of the current url
     */
    reload: function() {
      this.closePreviousView();
      Backbone.history.loadUrl(Backbone.history.fragment);
    },

    toFragment: function(args) {
      if (!args.push) {
        args = Array.prototype.slice.apply(arguments);
      }
      return '#!/' + args.join('/');
    }
  });

  return Router;
});

